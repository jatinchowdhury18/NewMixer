notifications:
  email: false

language: cpp
sudo: false

# if pull request: always build
# if push: only build for master branch
if: (type != push) OR (type = push AND branch = master)

matrix:
  include:
    - os: osx
      env:
        - BUILD_FOLDER="MacOSX"
        - PROJUCER_EXPORT="$TRAVIS_BUILD_DIR/JUCE/extras/Projucer/Builds/MacOSX/build/Debug/Projucer.app/Contents/MacOS/Projucer"
    - os: windows
      env:
        - MSBUILD_PATH="c:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\MSBuild\15.0\Bin"
        - BUILD_FOLDER="VisualStudio2017"
        - PROJUCER_EXPORT="$TRAVIS_BUILD_DIR/JUCE/extras/Projucer/Builds/VisualStudio2017/x64/Debug/App/Projucer.exe"

before_install:
  # mac installs
  - if [[ $TRAVIS_OS_NAME == 'osx' ]]; then gem install xcpretty; fi
  - if [[ $TRAVIS_OS_NAME == 'osx' ]]; then gem install xcpretty-travis-formatter; fi
  # windows setup msbuild path
  - if [[ $TRAVIS_OS_NAME == 'windows' ]]; then export PATH=$MSBUILD_PATH:$PATH; fi
  
  # Build Projucer
  - cd $TRAVIS_BUILD_DIR/JUCE/extras/Projucer/Builds/$BUILD_FOLDER
  - if [[ $TRAVIS_OS_NAME == 'osx' ]]; then xcodebuild -project Projucer.xcodeproj > /dev/null; fi
  - if [[ $TRAVIS_OS_NAME == 'windows' ]]; then msbuild.exe -v:quiet Projucer.sln; fi

script:
  - cd $TRAVIS_BUILD_DIR/
  - export PROJUCER=$PROJUCER_EXPORT
  - $PROJUCER --set-global-search-path $TRAVIS_OS_NAME defaultJuceModulePath  $TRAVIS_BUILD_DIR/JUCE/modules
  - $PROJUCER --resave NewMixer.jucer
  - cd $TRAVIS_BUILD_DIR/Builds/$BUILD_FOLDER/

  - if [[ $TRAVIS_OS_NAME == 'osx' ]]; then xcodebuild -project NewMixer.xcodeproj/ clean; fi
  - if [[ $TRAVIS_OS_NAME == 'osx' ]]; then xcodebuild -project NewMixer.xcodeproj/ -configuration Release | xcpretty -s -f `xcpretty-travis-formatter`; fi
  - if [[ $TRAVIS_OS_NAME == 'windows' ]]; then msbuild.exe -v:normal NewMixer.sln; fi
  - echo "SUCCESS"

after_success: # upload mac bins
  - |
    if [[ $TRAVIS_OS_NAME == 'osx' && type != push ]]; then
      echo "Copying Files..."
      cd $TRAVIS_BUILD_DIR/
      cp -R $TRAVIS_BUILD_DIR/Builds/MacOSX/build/Release/NewMixer.app $TRAVIS_BUILD_DIR/Bin/Mac/NewMixer.app

      echo "Setting Up Git..."
      git config --global user.email "travis@travis-ci.org"
      git config --global user.name "Travis CI"

      echo "Committing Files..."
      git checkout -b builds
      git add Bin/Mac/
      git commit -m "Travis build- $TRAVIS_BUILD_NUMBER"

      echo "Pushing to branch..."
      git push https://${GH_TOKEN}@github.com/jatinchowdhury18/NewMixer.git
    fi

env:
  global:
    secure: HDANAOVpJ18sQ+vKte1Xh+QlxoTEDMKuucW2YmYwsW8Clm0YrUV0B8pQ+jQsO207YM8eRb3vJYymZDkM1o+ByWWIkK3wGxccyPTszcUZZCwnlCrjBaGwzMib30O+RWOGfNa2qk05rcsdFnZ9+5AOLNEz4ESbK06a3/qb/li+1VPMI8dCv89IngZJhnQi8AiRUWtPqi8qi/lHHHLDqvB+sFygOafsBVI5LbMKfbr9aHMirlyQmLKdPWorwlY+ctL+CNKurx1mJiZ9B5bd7RzrXcpXymaV0dDRxzl4aioPTjT24Oyvwzu9iA6LmRfMeHp2b2o5UVgvlB5gN6O3XY2MJRlL6Shg+OtTKaA1lPmUrM8wW5pjDDujN/1ihm0us+kkBz6SjeFS46Sn0KPboZoeam+uqTFz00e5d8Z2vl3zt4HDJQbdZ3hqxljV3al+vutpc26Q5VfRgr177qmQYVejSrwnP+ZHX05TcNsZa0X0g6CvHWpGRnVDvmHo/1rjMrf02QpRj47/MqSS61SrBixUrtDnOIB9ASnj91VqfcGxW/wT/8fbiYZ5wuoLwdK7vNwn/qMwnM4zCn+/xTgzDq8ZuYQgVZ7XuIRUcpL5N3Vos0E5BtS3CC+GdYG2M1NyuN27ff+feOWLK1WpLvsuMOZSE5cMJYeNc2dbN3SAeiPEx4w=
